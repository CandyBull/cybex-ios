# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do
  desc "Description of what the lane does"
  lane :fir do
    app_identifier="com.nbltrustdev.cybex.fir"
    update_info_plist(
      plist_path:"cybexMobile/Info.plist",
      app_identifier: "#{app_identifier}"
    )
    gym(
      xcargs: "-UseNewBuildSystem=YES",
      output_name: "cybex-fir",
      scheme:"cybexMobile",
      workspace:"cybexMobile.xcworkspace",
      configuration:"Release",
      export_method:"ad-hoc",
      output_directory:"~/Documents/ipa",
      export_xcargs: "-allowProvisioningUpdates",
      export_options: {
        compileBitcode: false,
        provisioningProfiles: {
          app_identifier => "AdHoc com.nbltrustdev.cybex.fir"
        }
      }
    )
    firim(firim_api_token:"92fc2819f9894e4890c9fd27d4c1d234")
    slack(message: "Successfully distributed cybex to fir")
  end

  lane :publish do
    app_identifier="com.nbltrustdev.cybex"
    update_info_plist(
      plist_path:"cybexMobile/Info.plist",
      app_identifier: "AppStore #{app_identifier}"
    )
    gym(
      output_name: "cybex-appstore",
      scheme:"cybexMobile",
      workspace:"cybexMobile.xcworkspace",
      configuration:"Release",
      export_method:"app-store",
      output_directory:"~/Documents/ipa",
      export_xcargs: "-allowProvisioningUpdates",
      export_options: {
        compileBitcode: false,
        provisioningProfiles: {
          app_identifier => "#{app_identifier}"
        }
      }
    )
    appstore
    slack(message: "Successfully distributed cybex to appstore")
  end
  
   lane :test do
      app_identifier="com.nbltrustdev.cybex"
      update_info_plist(
        plist_path:"cybexMobile/Info.plist",
        app_identifier: "#{app_identifier}"
      )
      gym(
        output_name: "cybex-testflight",
        scheme:"cybexMobile",
        workspace:"cybexMobile.xcworkspace",
        configuration:"Release",
        export_method:"app-store",
        output_directory:"~/Documents/ipa",
        export_xcargs: "-allowProvisioningUpdates",
        export_options: {
          compileBitcode: false,
          provisioningProfiles: {
            app_identifier => "AppStore #{app_identifier}"
          }
        }
      )
      upload_to_testflight
      slack(message: "Successfully distributed cybex to testflight")
    end

end
